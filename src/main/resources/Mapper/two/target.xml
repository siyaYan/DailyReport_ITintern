<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.dailyReport.Mapper.two.target">
    <resultMap id="attendTable" type="com.example.dailyReport.Bean.Attend">
        <!--column 字段 property 必须一致-->
        <!--<id column="attend_id" javaType="INTEGER"/>-->
        <result column="school_id" property="school_id" jdbcType="INTEGER"/>
        <result column="class_id" property="class_id" jdbcType="INTEGER"/>
        <result column="person_id" property="person_id" jdbcType="INTEGER"/>
        <result column="person_name" property="person_name" jdbcType="VARCHAR"/>
        <!-- <result column="position" property="position" jdbcType="VARCHAR"/>-->
        <result column="attend_status" property="attend_status" jdbcType="INTEGER"/>
        <result column="attend_time" property="attend_time" jdbcType="INTEGER"/>
    </resultMap>

    <insert id="insertAttends"  useGeneratedKeys="true" keyColumn="attend_id" parameterType="java.util.List" >
        insert into attend(
        school_id,
        class_id,
        person_id,
        person_name,
        attend_status,
        attend_time)
        values
        <foreach collection="list" item="item" index="index" separator=",">
        (        #{item.school_id},#{
                item.class_id},#{
                item.person_id},#{
                item.person_name},#{
                item.attend_status},#{
                item.attend_time}
        )
        </foreach>
    </insert>

    <insert id="insertAttend"  useGeneratedKeys="true" keyColumn="attend_id" parameterType="com.example.dailyReport.Bean.Attend" >
        insert into attend
        (school_id,
         class_id,
         person_id,
         person_name,
         attend_status,
         attend_time)
        values
        (
            #{school_id},#{
            class_id},#{
            person_id},#{
            person_name},#{
            attend_status},#{
            attend_time}
        )
    </insert>

    <select id="selectClassIdByName" resultType="INTEGER">
        select class_id from class where class_name = #{param1} and stage = #{param2}
    </select>
    <select id="selectClassIdByPerson" resultType="INTEGER" parameterType="INTEGER">
        select class_id from person_class_relation where person_id = #{person_id}
    </select>
    <select id="selectPersonId" resultType="INTEGER" parameterType="java.lang.String">
        select person_id from person where third_no = #{student_no}
    </select>

    <select id="personNum" resultType="INTEGER" >
        select count(*) from person where school_id=#{school_id}  and person_type = #{type}
    </select>
    <select id="abnormalNum" resultType="INTEGER" >
        select count(*) from attend where school_id=#{school_id} and attend_status!=0
        and attend_time &gt;= #{date} and attend_time &lt;= ${date}+86399
    </select>

    <select id="selectRecentAttend" resultMap="attendTable">
        select
            school_id,
             class_id,
             person_id,
             person_name,
             attend_status,
             attend_time
        from attend where school_id=#{school_id}
    and attend_time &gt;= #{date} and attend_time &lt;= ${date}+86399
    </select>
</mapper>